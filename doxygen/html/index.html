<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mem-FG: MemFG</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mem-FG
   &#160;<span id="projectnumber">1.00.00</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MemFG </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>MemFG</b> is a module written in Python, which allows us to</p>
<ul>
<li>define user-custom models of dwarf spheroidal galaxies (dSphs),</li>
<li>evaluate, test, and compare dSph models,</li>
<li>search the parameter region of a given dSph,</li>
<li>estimate J-factor PDFs or confidencial intervals.</li>
</ul>
<p><b>MemFG</b> module is implemented to satisfy that</p>
<ul>
<li>dSph models can be defined by using a specific model format in MemFG,</li>
<li>all of the output files yielded by MemFG have a user-friendly and easily-reuseable format,</li>
<li>statistical frameworks can be swicthed between such as frequentist statistics or Bayesian statistics.</li>
<li>sampling algorithm can be switched among several MCMC or nested samplers.</li>
</ul>
<h1>Todo</h1>
<h2><code>Parameter</code> class?</h2>
<ul>
<li>Usually, a likelihood function has many parameters (more than 10). Let us consider that we pass these parameters to the likelihood as:</li>
</ul>
<div class="fragment"><div class="line">likelihood(p0,p1,p2,p3,p4,p5,...)</div></div><!-- fragment --><p>This may cause some bugs such that</p>
<div class="fragment"><div class="line">likelihood(p0,!p2,!p3,!p1,p4,...)</div></div><!-- fragment --><p>Of cource, we can avoid such bugs by taking very careful to the order of the arguments. However, if we can just call the likelihood as:</p>
<div class="fragment"><div class="line">likelihood(ps)</div></div><!-- fragment --><p>this helps us to coding very quickly. In order to achieve this feature, we should define a format of the order of the arguments <code>ps</code>. We should take care that the <code>emcee.EnsembleSampler</code> is defined as:</p>
<blockquote class="doxtable">
<p><code>emcee.EnsembleSampler(nwalkers, dim, lnpostfn, a=2.0, args=[], kwargs={},...)</code> </p>
</blockquote>
<p>where</p>
<blockquote class="doxtable">
<p><code>lnpostfn</code>: A function that takes a <b>vector</b> (<b>numpy.array</b>) in the parameter space as input and returns the natural logarithm of the posterior probability for that position. </p>
</blockquote>
<p>Moreover, we should also take care that the computational cost of the likelihood function should be small.</p>
<p>一番実装が簡単なのは、Arrayをそのまま使ってしまうこと。例えばLikelihoodの中で、 p0,p1,p2, ... = ps とか展開して、それぞれのpiはこういう意味だから...とか考えながら、適宜Likelihoodの中で使う。 しかしこれは非常に危ない（取り違えが起きる可能性ありまくる）。 順番がめちゃめちゃにならないようにどっかでパラメータの順番を明示的に指定してあげて、 「この変数はこのパラメータ、この変数はこのパラメータ」と教えてあげたいのだが、 それをやると結局そこに問題を押し付けただけになる（そこで間違えたらどうする？）。 例えば間違えないように、 velocity = p["velocity"], position = p["position"], みたいな代入をしてもいいけれど、これだとなんか関数を定義するたびに頭で毎回こういうことをしないといけなくなる。 これはいちいち時間を食うし（dict型ならそんなでもない）、冗長である（これはそう）。 かといって、関数の引数にデデンと全部書いてしまうと、それこそ20個近い変数を全部書くことになって、可視性が悪い。</p>
<p>Likelihood、というか継承・複合しまくったモデルのパラメータが肥大する理由は、各々のモデルの持っているパラメータが全部一つにまとまってしまうから。 しかし実際はパラメータは各々のモデルにBoundされた概念である。なので、それごとに分けてしまえばそれほど数は大きくならない（はず）。</p>
<p>Hence, in order to achieve this feature, we separate the definition of likelihood from the implementation of likelihood. In a definition step,</p>
<div class="fragment"><div class="line">def likelihood(Parameters params):</div><div class="line">    (some computation)</div><div class="line">    return ret</div></div><!-- fragment --><p>Then, Model class understand this likelihood function as</p>
<div class="fragment"><div class="line">def likelihood(np.array ps)</div><div class="line">    ...</div></div><!-- fragment --><p>Is is possible???</p>
<h2>Implementation</h2>
<p>To achieve the demands mentioned above, MemFG has the following classes:</p>
<ul>
<li>class <code>Model</code>: define all physical or statistical models in MemFG.<ul>
<li><code>Model</code> has <code>parameters</code>.<ul>
<li><code>parameters</code> is a <code>list</code> of <code>Parameter</code>s.</li>
</ul>
</li>
<li><code>Model</code> has <code>submodels</code>.<ul>
<li><code>submodels</code> is a <code>list</code> of <code>Model</code>s.</li>
</ul>
</li>
<li><code>Model</code> has <code>all_parameters</code>. <code>all_parameters</code> is a list of <code>Parameter</code>s which a <code>Model</code> of submodels` has.</li>
<li><code>Model</code> has some <code>function</code>s.<ul>
<li><code>function</code> has a <code>body</code>.</li>
<li><code>function</code> has a <code>args</code>.<ul>
<li><code>args</code> is some <code>names</code> of <code>parameters</code>.</li>
</ul>
</li>
<li><code>function</code> can <code>check_args</code>: <code>check_args(params)</code>:<ul>
<li>params: a instance of <code>Parameters</code></li>
</ul>
</li>
<li><code>function</code> can <code>__call__</code>: <code>__call__(params)</code>:<ul>
<li>params: a instance of <code>Parameters</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>* class <code>Parameters</code>: ??? (Is it actually required?)<ul>
<li><code>Parameters</code> is a <code>list</code>.　??? (or has a <code>list</code> or <code>dict</code> of <code>Parameters</code>???)</li>
<li><code>Parameters</code> has a <code>names</code>.</li>
<li><code>Parameters</code> has a <code>values</code>.</li>
<li><code>Parameters</code> can <code>assign_values</code>.</li>
<li><code>Parameters</code> can <code>clear_values</code>.</li>
</ul>
</li>
<li>class <code>Parameter</code>:<ul>
<li><code>Parameter</code> has <code>name</code>.</li>
<li>* <code>Parameter</code> has <code>unit</code>.</li>
<li><code>Parameter</code> has <code>value</code>.</li>
<li><code>Parameter</code> can <code>clear_value</code></li>
<li><code>Parameter</code> can <code>assign_value</code></li>
<li>* <code>Parameter</code> can <code>convert_unit</code></li>
</ul>
</li>
<li>class <code>DMModel</code>: define dark matter density profile.<ul>
<li><code>DMModel</code> is a <code>Model</code>.</li>
<li><code>DMModel</code> has <code>enclosure_mass</code>.</li>
<li><code>DMModel</code> has <code>density_profile</code>.</li>
</ul>
</li>
<li>class <code>StellarModel</code>: define stellar models of dSPhs.<ul>
<li><code>StellarModel</code> is a <code>Model</code>.</li>
<li><code>StellarModel</code> has</li>
</ul>
</li>
<li>class <code>PlummerModel</code>: define the Plummer model.<ul>
<li><code>PlummerModel</code> has a <code>list</code> of <code>Parameter</code>: <code>r_half</code></li>
</ul>
</li>
<li>class <code>dSphModel</code>: define dSph models.<ul>
<li><code>dSphModel</code> is a <code>Model</code>.</li>
<li><code>dSphModel</code> has <code>stellar_model</code> and <code>dm_model</code>.<ul>
<li><code>stellar_model</code> is a <code>StellarModel</code>.</li>
<li><code>dm_model</code> is a <code>DMModel</code>.</li>
</ul>
</li>
<li><code>Model</code> can <code>fit</code> <code>ObservedData</code>,</li>
<li><code>Model</code> can <code>evaluate_loglikelihood</code> based on <code>ObservedData</code>,</li>
</ul>
</li>
<li>``</li>
<li></li>
<li></li>
</ul>
<h1></h1>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
